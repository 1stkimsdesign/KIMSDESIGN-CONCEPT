<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ ë””ìì¸ ì»¨ì…‰ ê¸°íš ìƒì„±ê¸°</title>
<meta name="description" content="ì‚°ì—…/ëª©ì /ìš©ë„/íƒ€ê²Ÿ/í†¤/ì œì•½/ë¸Œëœë“œ/ì´ë¯¸ì§€/ì—ë„ˆì§€ + í˜ë¥´ì†Œë‚˜ â†’ ë¬´ë“œ/ì»¬ëŸ¬/ì„œì²´/ë ˆì´ì•„ì›ƒ/êµ¬ì„±ë¹„ìœ¨/í˜ë¥´ì†Œë‚˜ ìë™ ìƒì„±">
<style>
  :root{
    --bg:#fff; --fg:#0b0b0c; --muted:#6b7280; --line:#e5e7eb; --card:#f8fafc;
    --accent:#2563eb; --ok:#16a34a;
  }
  *{box-sizing:border-box; print-color-adjust:exact; -webkit-print-color-adjust:exact}
  html,body{margin:0}
  body{font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Pretendard,Roboto,Helvetica,Arial;background:var(--bg);color:var(--fg)}
  header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:20}
  .wrap{max-width:1080px;margin:0 auto;padding:18px}
  .brand{display:flex;align-items:center;gap:12px;font-weight:900}
  .badge{font-size:12px;color:#334155;border:1px solid var(--line);background:#eef2ff;padding:4px 10px;border-radius:999px}
  .grid{display:grid;gap:14px}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
  h1,h2,h3{margin:0 0 8px 0}
  p{margin:6px 0}
  select, input{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{padding:12px 16px;border:1px solid var(--line);border-radius:12px;background:linear-gradient(#fff,#f3f4f6);cursor:pointer}
  .btn.primary{
    border:none;
    background:linear-gradient(90deg,#60a5fa,#34d399);
    color:#0b0b0c; font-weight:900;
    box-shadow:0 6px 20px rgba(52,211,153,.25);
  }
  .btn.toggle{background:#fff;border:1px solid var(--line);font-weight:700}
  .btn.toggle.active{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.25)}
  .small{font-size:12px;color:var(--muted)}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}
  .card>:last-child{margin-bottom:0}
  .col3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width: 980px){ .col3{grid-template-columns:1fr} }

  .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#334155;font-size:12px}
  .swatch{display:flex;gap:10px;flex-wrap:wrap}
  .swatch .c{width:92px;border:1px solid var(--line);border-radius:10px;overflow:hidden;background:#fff}
  .swatch .c div{height:50px}
  .swatch .c span{display:block;padding:6px 6px 8px;font-size:11px;text-align:center;color:#334155}

  .resultGrid{display:grid;grid-template-columns:1.2fr 1fr;gap:14px}
  @media (max-width: 980px){ .resultGrid{grid-template-columns:1fr} }

  .bars{display:grid;gap:8px}
  .barRow{display:grid;grid-template-columns:140px 1fr;gap:10px;align-items:center}
  .bar{height:12px;background:#e5e7eb;border-radius:999px;overflow:hidden}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#22d3ee)}

  /* ìš”ì•½ ì¹´ë“œ ë‚´ë¶€ ë¬´ë“œ ê°•ì¡° ë°•ìŠ¤ */
  .moodBox{
    margin-top:10px; border:1px solid var(--line); border-radius:14px; padding:12px;
    background:linear-gradient(135deg,#eff6ff 0%, #fff 45%, #fdf2f8 100%);
    box-shadow:0 6px 18px rgba(37,99,235,.08);
  }
  .moodTitle{font-size:20px;font-weight:900;margin-bottom:6px}
  .moodTags{display:flex;gap:8px;flex-wrap:wrap}

  /* ì»´íŒ©íŠ¸ í…ìŠ¤íŠ¸ ì¹´ë“œ */
  .compact ul{font-size:13px; line-height:1.6; margin:6px 0 0 18px}
  .compact p, .compact .small{font-size:12px}

  /* ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ ì¶”ì²œ(ì •í™• ë¹„ìœ¨ + ì¶”ì²œ ê°•ì¡°) */
  .previewLine{display:flex;gap:12px;align-items:center;flex-wrap:nowrap;overflow-x:auto}
  .ratio{
    flex:0 0 auto; width:108px; height:72px; border:1px solid var(--line); border-radius:12px;
    position:relative; background:#fff; opacity:.35;
  }
  .ratio.active{opacity:1; border:2px solid #60a5fa}
  .ratio .inner{
    position:absolute; display:block; background:rgba(99,102,241,.08);
    border:2px dotted #93c5fd; border-radius:8px;
  }
  .ratio label{position:absolute; bottom:4px; left:0; right:0; text-align:center; font-size:11px; color:#334155}

  /* ëª¨ë‹¬ */
  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.35); z-index:50}
  .modal .box{background:#fff; border-radius:14px; padding:16px 18px; width:min(380px,92vw); box-shadow:0 10px 30px rgba(0,0,0,.2)}

  /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
  .loading{position:fixed; inset:0; display:none; place-items:center; background:rgba(255,255,255,.9); z-index:60}
  .spinner{
    width:52px; height:52px; border:6px solid #e5e7eb; border-top-color:#60a5fa; border-radius:50%;
    animation:spin 1s linear infinite; margin:0 auto 12px;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  @media print{
    header{position:static; background:#fff}
    .btn{display:none}
    body{background:#fff}
  }
</style>
</head>
<body>
<header>
  <div class="wrap brand">
    <div style="font-size:22px">ğŸ ë””ìì¸ ì»¨ì…‰ ê¸°íš ìƒì„±ê¸°</div>
    <span class="badge">ë“œë¡­ë‹¤ìš´ 9ë¬¸í•­ + í˜ë¥´ì†Œë‚˜ â†’ ë¬´ë“œÂ·ì»¬ëŸ¬Â·ì„œì²´Â·ë ˆì´ì•„ì›ƒÂ·êµ¬ì„±ë¹„ìœ¨ ìë™ ì¶”ì²œ</span>
  </div>
</header>

<div class="wrap grid">

  <!-- ============ STEP 1: ì§ˆë¬¸ ============ -->
  <section id="screen-ask" class="panel grid">
    <div class="row" style="justify-content:space-between">
      <h2>1) ì§ˆë¬¸ì— ë‹µí•´ ì£¼ì„¸ìš” (9ë¬¸í•­ + í˜ë¥´ì†Œë‚˜)</h2>
      <div class="tag">ëª¨ë“  í•­ëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤</div>
    </div>

    <div class="col3">
      <!-- 1~9 ë“œë¡­ë‹¤ìš´ -->
      <div class="card"><h3>â‘  ì‚°ì—…êµ°</h3>
        <select id="q_industry">
          <option value="-">-</option>
          <option value="tech">IT/í…Œí¬</option><option value="fashion">íŒ¨ì…˜/ë·°í‹°</option>
          <option value="food">í‘¸ë“œ/ë ˆìŠ¤í† ë‘</option><option value="finance">ê¸ˆìœµ/í•€í…Œí¬</option>
          <option value="culture">ë¬¸í™”/ì „ì‹œ</option><option value="edu">êµìœ¡/ê³µê³µ</option>
          <option value="sports">ìŠ¤í¬ì¸ /ë ˆì €</option><option value="travel">ì—¬í–‰/ê´€ê´‘</option>
          <option value="auto">ìë™ì°¨/ëª¨ë¹Œë¦¬í‹°</option><option value="game">ê²Œì„/eìŠ¤í¬ì¸ </option>
          <option value="estate">ë¶€ë™ì‚°/ê±´ì„¤</option><option value="health">ì˜ë£Œ/í—¬ìŠ¤ì¼€ì–´/ì œì•½</option>
          <option value="home">ê°€ì „/ê°€êµ¬/ë¦¬ë¹™</option><option value="music">ìŒì•…/ì—”í„°</option>
          <option value="ngo">ë¹„ì˜ë¦¬/NGO</option>
        </select><p class="small">ë¬´ë“œÂ·íƒ€ì´í¬Â·ì´ë¯¸ì €ë¦¬ì— ê°€ì¤‘ì¹˜</p>
      </div>

      <div class="card"><h3>â‘¡ ëª©ì </h3>
        <select id="q_goal">
          <option value="-">-</option>
          <option value="conversion">ì „í™˜/êµ¬ë§¤/ê°€ì…</option>
          <option value="awareness">ë¸Œëœë“œ ì¸ì§€ë„</option>
          <option value="education">ì•ˆë‚´/ì„¤ëª…</option>
          <option value="campaign">ìº í˜ì¸/ì´ë²¤íŠ¸</option>
        </select><p class="small">ì •ë³´ ìœ„ê³„/ê°•ì¡° ê°•ë„ ë°˜ì˜</p>
      </div>

      <div class="card"><h3>â‘¢ ìš©ë„/ë§¤ì²´</h3>
        <select id="q_platform">
          <option value="-">-</option>
          <option value="web">ì›¹ ëœë”©/í”„ë¡œë•íŠ¸</option>
          <option value="app">ëª¨ë°”ì¼ ì•±</option>
          <option value="sns">SNS/ë°°ë„ˆ/ì¹´ë“œë‰´ìŠ¤</option>
          <option value="poster">í¬ìŠ¤í„°/ì¸ì‡„</option>
        </select><p class="small">ì„¸ì´í”„ ì¡´/í…ìŠ¤íŠ¸ í¬ê¸° ë°˜ì˜</p>
      </div>

      <div class="card"><h3>â‘£ íƒ€ê²Ÿ</h3>
        <select id="q_audience">
          <option value="-">-</option>
          <option value="gen">ëŒ€ì¤‘</option><option value="youth">10â€“20ëŒ€</option>
          <option value="adult">30â€“40ëŒ€</option><option value="pro">ì „ë¬¸ê°€/ì—…ê³„</option>
          <option value="premium">í”„ë¦¬ë¯¸ì—„</option>
        </select><p class="small">ê°€ë…ì„±/ê°œì„±/ëŒ€ë‹´í•¨ ê°€ì¤‘ì¹˜</p>
      </div>

      <div class="card"><h3>â‘¤ í†¤ì•¤ë§¤ë„ˆ</h3>
        <select id="q_tone">
          <option value="-">-</option>
          <option value="trust">ì‹ ë¢°Â·ì •ì œ</option><option value="friendly">ì¹œê·¼Â·ë¶€ë“œëŸ¬ì›€</option>
          <option value="bold">ëŒ€ë‹´Â·ê°•ë ¬</option><option value="warm">ë”°ëœ»Â·íœ´ë¨¼</option>
        </select><p class="small">íƒ€ì´í¬/ì»¬ëŸ¬ ëŒ€ë¹„ì— ë°˜ì˜</p>
      </div>

      <div class="card"><h3>â‘¥ ì œì•½ ì‚¬í•­</h3>
        <select id="q_ban">
          <option value="-">-</option>
          <option value="none">ì—†ìŒ</option>
          <option value="noNeon">ë„¤ì˜¨/ê°•í•œ ê·¸ë¼ë””ì–¸íŠ¸ ê¸ˆì§€</option>
          <option value="hiDensity">í•œ í™”ë©´ ê³¼ë°€ ë°°ì¹˜ ê¸ˆì§€</option>
          <option value="brandStrict">ë¸Œëœë“œ ê°€ì´ë“œ ì—„ìˆ˜(ìƒ‰/ë¡œê³  ë³€í˜• ê¸ˆì§€)</option>
          <option value="noStocky">ê³¼ë„í•œ ìŠ¤í†¡ì‚¬ì§„ ëŠë‚Œ ê¸ˆì§€</option>
        </select><p class="small">íŒ”ë ˆíŠ¸/ì´ë¯¸ì§€/í…ìŠ¤íŠ¸ ë°€ë„ ì œì•½</p>
      </div>

      <div class="card"><h3>â‘¦ ë¸Œëœë“œ ì„±ê²©</h3>
        <select id="q_brand">
          <option value="-">-</option>
          <option value="innovative">í˜ì‹ ì </option><option value="reliable">ì‹ ë¢°/ì•ˆì •</option>
          <option value="friendly">ì¹œê·¼/ìœ ë¨¸</option><option value="luxury">í”„ë¦¬ë¯¸ì—„/ê°ì„±</option>
        </select><p class="small">ë¬´ë“œÂ·íƒ€ì´í¬ ë¯¸ì„¸ ì¡°ì •</p>
      </div>

      <div class="card"><h3>â‘§ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼</h3>
        <select id="q_visual">
          <option value="-">-</option>
          <option value="photo">ì‚¬ì§„ ì¤‘ì‹¬</option>
          <option value="illustration">ì¼ëŸ¬ìŠ¤íŠ¸ ì¤‘ì‹¬</option>
          <option value="iconic">ì•„ì´ì½˜/í”½í†  ìŠ¤íƒ€ì¼</option>
          <option value="mixed">í˜¼í•©</option>
        </select><p class="small">ì´ë¯¸ì§€/ì•„ì´ì½˜ ë°©í–¥</p>
      </div>

      <div class="card"><h3>â‘¨ ì—ë„ˆì§€ ë ˆë²¨</h3>
        <select id="q_energy">
          <option value="-">-</option>
          <option value="calm">ì°¨ë¶„/ì •ëˆ</option>
          <option value="balanced">ê· í˜•</option>
          <option value="dynamic">ì—­ë™/í™œê¸°</option>
        </select><p class="small">ëŒ€ë‹´í•¨Â·ìƒ‰ì±„ ê°•ë„</p>
      </div>

      <!-- â‘© í˜ë¥´ì†Œë‚˜ ì„ íƒ/ì…ë ¥ -->
      <div class="card">
        <h3>â‘© í˜ë¥´ì†Œë‚˜</h3>
        <div class="row">
          <button type="button" class="btn toggle" id="btnAuto">ìë™ í˜ë¥´ì†Œë‚˜</button>
          <button type="button" class="btn toggle" id="btnManual">ìˆ˜ë™ í˜ë¥´ì†Œë‚˜</button>
        </div>
        <div id="ps_form" style="display:none; margin-top:10px">
          <div class="row" style="gap:10px">
            <input id="ps_name" placeholder="ì´ë¦„(ê°€ëª…)" />
            <select id="ps_age" style="max-width:220px">
              <option value="">ì—°ë ¹ëŒ€</option>
              <option>18â€“24</option><option>25â€“34</option><option>35â€“44</option><option>45â€“54</option>
            </select>
          </div>
          <input id="ps_role" placeholder="ì§ë¬´(ì˜ˆ: í”„ë¡œë•íŠ¸ ë§ˆì¼€í„°)" style="margin-top:8px" />
          <input id="ps_channels" placeholder="ì£¼ìš” ì±„ë„(ì‰¼í‘œ: ì¸ìŠ¤íƒ€ê·¸ë¨, ìœ íŠœë¸Œâ€¦)" style="margin-top:8px" />
          <div class="row" style="gap:10px; margin-top:8px">
            <select id="ps_style">
              <option value="">ì„ í˜¸ ìŠ¤íƒ€ì¼</option>
              <option value="ì •ì œ/ëª…ë£Œ">ì •ì œ/ëª…ë£Œ</option>
              <option value="ë°ê³  ì¹œê·¼">ë°ê³  ì¹œê·¼</option>
              <option value="ëŒ€ë‹´/ê°•ì¡°">ëŒ€ë‹´/ê°•ì¡°</option>
              <option value="ë”°ëœ»/íœ´ë¨¼">ë”°ëœ»/íœ´ë¨¼</option>
            </select>
            <input id="ps_goal" placeholder="ëª©í‘œ(ì˜ˆ: ì „í™˜ìœ¨ í–¥ìƒ, ì¸ì§€ë„â€¦)" />
          </div>
          <input id="ps_pain" placeholder="Pain Point(ì˜ˆ: ì²« ì¥ ì´íƒˆ, ê°€ì¹˜ì „ë‹¬ ì§€ì—°â€¦)" style="margin-top:8px" />
        </div>
        <p class="small" style="margin-top:8px">â€» ìˆ˜ë™ ì…ë ¥ì€ ì ìˆ˜ì— ì˜í–¥ ì—†ì´ ê²°ê³¼ì§€ì— ê·¸ëŒ€ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
      </div>
    </div>

    <div class="row" style="justify-content:flex-end">
      <button class="btn primary" id="goResult">ğŸš€ ê¸°íš ìƒì„±</button>
    </div>
  </section>

  <!-- ============ STEP 2: ê²°ê³¼ ============ -->
  <section id="screen-result" class="panel grid" style="display:none">
    <div class="row" style="justify-content:space-between">
      <h2>ğŸ¯ ì»¨ì…‰ ë³´ë“œ</h2>
      <div class="row">
        <button class="btn" id="back">â—€ ë‹¤ì‹œ ì„ íƒ</button>
        <button class="btn" id="print">ì¸ì‡„/PDF</button>
      </div>
    </div>

    <div class="resultGrid">
      <!-- ì™¼ìª½ ì»¬ëŸ¼ -->
      <div class="grid" style="gap:14px">
        <div class="card" id="summaryCard">
          <h3>ğŸ“Œ ìš”ì•½</h3>
          <div class="row" style="gap:8px;margin-top:4px">
            <span class="tag" id="tagIndustry">#ì‚°ì—…</span>
            <span class="tag" id="tagGoal">#ëª©ì </span>
            <span class="tag" id="tagPlatform">#ìš©ë„</span>
            <span class="tag" id="tagAudience">#íƒ€ê²Ÿ</span>
            <span class="tag" id="tagTone">#í†¤</span>
            <span class="tag" id="tagBan">#ì œì•½</span>
          </div>
          <p class="small" id="summaryText" style="margin-top:8px"></p>
          <!-- ë¬´ë“œ ê°•ì¡° -->
          <div class="moodBox">
            <div class="moodTitle" id="moodTitle">ë¬´ë“œ ìë™ íŒì •</div>
            <div class="moodTags" id="moodTags"></div>
          </div>
        </div>

        <!-- í˜ë¥´ì†Œë‚˜ (ì„¸ë¶„í™”) -->
        <div class="card" id="personaCard">
          <h3>ğŸ§‘â€ğŸ¨ í•µì‹¬ í˜ë¥´ì†Œë‚˜</h3>
          <div class="row" id="personaHeader" style="gap:8px;margin-top:4px"></div>
          <ul id="personaPoints" style="margin:8px 0 0 18px; line-height:1.65; font-size:13px"></ul>
          <div class="small" id="personaImp" style="margin-top:8px"></div>
        </div>

        <!-- ì»¬ëŸ¬ -->
        <div class="card">
          <h3>ğŸ¨ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸</h3>
          <div class="swatch" id="swatches" style="margin-top:6px"></div>
          <div class="row" style="gap:10px;margin-top:10px">
            <div class="tag" id="contrastNote">ê°€ë…ì„±: -</div>
            <div class="bar" style="flex:1 1 200px;height:14px"><i id="meter" style="width:0%;height:100%;background:linear-gradient(90deg,#fca5a5,#60a5fa)"></i></div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ -->
      <div class="grid" style="gap:14px">
        <div class="card compact">
          <h3>ğŸ”¡ íƒ€ì´í¬ê·¸ë˜í”¼</h3>
          <ul id="typoList"></ul>
          <p class="small" id="typeAccess">ì›¹ ì ‘ê·¼ì„±: ë§¤ìš° ìš°ìˆ˜</p>
        </div>

        <div class="card compact">
          <h3>ğŸ“ ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ ì¶”ì²œ</h3>
          <ul id="gridList"></ul>
          <div class="small" style="margin-top:8px">ë¹„ìœ¨ ê°€ì´ë“œ</div>
          <div class="previewLine" id="ratioLine"></div>
        </div>

        <!-- ë³µêµ¬: êµ¬ì„± ë¹„ìœ¨ ê·¸ë˜í”„ -->
        <div class="card">
          <h3>ğŸ“Š êµ¬ì„± ë¹„ìœ¨(ì´ë¯¸ì§€/í…ìŠ¤íŠ¸/ì—¬ë°±/CTA)</h3>
          <div class="bars" id="compBars" style="margin-top:8px"></div>
        </div>

        <div class="card">
          <h3>ğŸ“ˆ ì»¨ì…‰ ì„±í–¥ ê·¸ë˜í”„</h3>
          <div class="bars" id="barBox" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </section>

  <footer>â€» ê¹€ì”¨ë„¤ë””ìì¸ì‹¤ ìì²´ ì œì‘ ì½˜í…ì¸  â€” ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ ê¸ˆì§€</footer>
</div>

<!-- ëª¨ë‹¬: í•„ìˆ˜ ì²´í¬ -->
<div class="modal" id="modalRequire">
  <div class="box">
    <h3 style="margin:0 0 8px 0">ì²´í¬ í•„ìš”</h3>
    <p style="margin:0 0 10px 0">ëª¨ë“  í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" onclick="closeModal('modalRequire')">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ìë™ í˜ë¥´ì†Œë‚˜ ì•Œë¦¼ -->
<div class="modal" id="modalAuto">
  <div class="box">
    <h3 style="margin:0 0 8px 0">ìë™ í˜ë¥´ì†Œë‚˜</h3>
    <p style="margin:0 0 10px 0">ìë™ í˜ë¥´ì†Œë‚˜ê°€ ì ìš©ë˜ì–´ ì»¨ì…‰ ë³´ë“œì— ë…¸ì¶œë©ë‹ˆë‹¤.</p>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" onclick="closeModal('modalAuto')">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading" id="loading">
  <div>
    <div class="spinner"></div>
    <div style="text-align:center;font-weight:800">ì»¨ì…‰ ë³´ë“œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤â€¦</div>
  </div>
</div>

<script>
/* ---------- ìœ í‹¸ ---------- */
const $ = s => document.querySelector(s);

/* ---------- ë°ì´í„°: ë¬´ë“œ ---------- */
const MOOD_INFO = {
  modern:{label:'ëª¨ë”ë‹ˆì¦˜ ğŸ§©', colors:['#111827','#2563eb','#e5e7eb','#0ea5e9','#f8fafc'], tags:['ì§ˆì„œ','ë³´í¸ì„±','ì ˆì œ']},
  minimal:{label:'ë¯¸ë‹ˆë©€ ğŸŒ«ï¸', colors:['#0f172a','#94a3b8','#f1f5f9','#334155','#e2e8f0'], tags:['ì—¬ë°±','ì •ëˆ','ì°¨ë¶„']},
  retro:{label:'ë ˆíŠ¸ë¡œ ğŸ“¼', colors:['#5b3a29','#eab308','#ef4444','#fde68a','#f3e8ff'], tags:['ë³µê³ ','ì§ˆê°','ë…¸ìŠ¤íƒ¤ì§€ì•„']},
  brutal:{label:'ë¸Œë£¨íƒˆë¦¬ì¦˜ ğŸ§¨', colors:['#000000','#22c55e','#facc15','#e11d48','#ffffff'], tags:['ëŒ€ë‹´','ë‚ ê²ƒ','ì›ìƒ‰']},
  pop:{label:'íŒ/ìºì£¼ì–¼ ğŸ‰', colors:['#111827','#f43f5e','#fb923c','#22d3ee','#fef3c7'], tags:['ë°œë„','ì¹œê·¼','ë¹„ë¹„ë“œ']},
  tech:{label:'í…Œí¬/ì‚¬ì´ë²„ ğŸ’¾', colors:['#0b0b0c','#22d3ee','#60a5fa','#a78bfa','#111827'], tags:['ë„¤ì˜¨','í´ë¦°','ë””ì§€í„¸']},
  warm:{label:'ì›œ/íœ´ë¨¼ â˜•', colors:['#1f2937','#d97706','#b45309','#fde68a','#fdf2f8'], tags:['ë”°ëœ»','íœ´ë¨¼','ì‹ ë¢°']},
  organic:{label:'ì˜¤ê°€ë‹‰ ğŸŒ¿', colors:['#0b3d2e','#34d399','#b5e0d3','#fefce8','#f1f5f9'], tags:['ìì—°','ì†Œí”„íŠ¸','ì¹œí™˜ê²½']},
  luxury:{label:'ëŸ­ì…”ë¦¬ ğŸ’', colors:['#0b0b0c','#a78bfa','#d4af37','#f1f5f9','#1f2937'], tags:['í”„ë¦¬ë¯¸ì—„','ì„¸ë ¨','ì ˆì œëœ ê´‘íƒ']},
  y2k:{label:'Y2K âœ¨', colors:['#0b0b0c','#a78bfa','#22d3ee','#f472b6','#ffffff'], tags:['ë„¤ì˜¨','ê¸€ë¡œì‹œ','ë¯¸ë˜ì§€í–¥']},
  classic:{label:'ë„¤ì˜¤í´ë˜ì‹ ğŸ›ï¸', colors:['#1f2937','#9ca3af','#f9fafb','#a855f7','#111827'], tags:['ì •ì œ','ê· í˜•','ì „í†µ']},
  sporty:{label:'ìŠ¤í¬í‹° ğŸƒ', colors:['#0b0b0c','#22c55e','#ef4444','#60a5fa','#f1f5f9'], tags:['ì—ë„ˆì§€','ì„ ëª…','ì‹¤ìš©']},
  cozy:{label:'ì½”ì§€ â˜•ï¸', colors:['#1f2937','#d97706','#a3a3a3','#fde68a','#fdf2f8'], tags:['ë”°ëœ»','ë¹ˆí‹°ì§€','ë¶€ë“œëŸ¬ì›€']}
};

/* ---------- ê°€ì´ë“œ/íƒ€ì´í¬ ---------- */
const LAYOUT_GUIDE = {
  web:[
    'íˆì–´ë¡œ: í•µì‹¬ ë¬¸êµ¬ 5â€“8ë‹¨ì–´ + CTA 1ê°œ',
    'ë¼ì¸ ê¸¸ì´ 45â€“75ì / ì„¹ì…˜ ê°„ 48â€“72px',
    'ë¦¬ë“œ 16â€“18px, ì¹´ë“œí˜• ë¦¬ìŠ¤íŠ¸ë¡œ ë©ì–´ë¦¬í™”',
    'í¼/ë‹¤ìš´ë¡œë“œëŠ” 1ì°¨ CTAì™€ ê·¸ë£¹í™”'
  ],
  app:[
    'ì»´í¬ë„ŒíŠ¸ ë°˜ë³µ(ì¹´ë“œ/ë¦¬ìŠ¤íŠ¸/ë²„íŠ¼)ë¡œ ë¦¬ë“¬ ìœ ì§€, í„°ì¹˜ ìµœì†Œ 44px',
    'ìƒÂ·í•˜ë‹¨ ë„¤ë¹„ ì¤‘ì‹¬ íë¦„, ì¤‘ì²© ëª¨ë‹¬ ìµœì†Œí™”',
    'ë³¸ë¬¸ 15â€“17px / ìƒíƒœ í”¼ë“œë°± ëª…ë£Œí™”',
    'í‚¤ ì•¡ì…˜ì€ í•˜ë‹¨ ê³ ì • CTA'
  ],
  sns:[
    'ìŠ¬ë¼ì´ë“œ 20â€“40ì / 10ì¥ ê¸°ì¤€ 1â€“2 ë©”ì‹œì§€',
    'í…ìŠ¤íŠ¸:ì´ë¯¸ì§€ 6:4~4:6 / ì²« ì¥ì€ ì¸ë„¤ì¼',
    'í…œí”Œë¦¿(íƒ€ì´í‹€/ë°”ë””/ì¶œì²˜) í†µì¼',
    'ì„¸ì´í”„ ì¡´ 60px / ë²ˆí˜¸Â·ì§„í–‰ë°” ì œê³µ'
  ],
  poster:[
    'í‚¤ ë©”ì‹œì§€ 5â€“7ë‹¨ì–´ / ì •ë³´ ê³„ì¸µí™”(ì¥ì†ŒÂ·ì¼ì‹œÂ·ë¬¸ì˜)',
    'ì›ê±°ë¦¬Â·ê·¼ê±°ë¦¬ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ë¦¬',
    'QR/URL ëŒ€ë¹„ í™•ë³´ / ë¯¸ì„¸ ì—¬ë°± ìœ ë„',
    'ì¸ì‡„ ì—¬ë¶„ 3mm / ì´ë¯¸ì§€ 200â€“300ppi'
  ]
};

const TYPO_POOL = {
  body: [
    'Pretendard','Noto Sans KR','Inter','Roboto','Source Sans 3','Open Sans',
    'IBM Plex Sans KR','Spoqa Han Sans Neo','Nanum Gothic','SUIT','Gmarket Sans',
    'Lato','Harmonia Sans','Malgun Gothic','Apple SD Gothic Neo'
  ],
  head: [
    'Montserrat','Poppins','Oswald','Bebas Neue','Noto Serif KR','DM Serif Display',
    'Playfair Display','Raleway','Lora','Cormorant Garamond','Archivo Black',
    'Futura PT','Cinzel','Cabinet Grotesk','Pretendard Black'
  ]
};

/* ---------- ìƒ‰ ëŒ€ë¹„ ìœ í‹¸ ---------- */
function hexToRgb(hex){hex=hex.replace('#',''); if(hex.length===3) hex=[hex[0],hex[0],hex[1],hex[1],hex[2],hex[2]].join(''); const num=parseInt(hex,16); return {r:(num>>16)&255,g:(num>>8)&255,b:num&255}}
function luminance({r,g,b}){const s=[r/255,g/255,b/255].map(v=>v<=0.03928?v/12.92:((v+0.055)/1.055)**2.4);return 0.2126*s[0]+0.7152*s[1]+0.0722*s[2]}
function contrast(hex1,hex2){const L1=luminance(hexToRgb(hex1)),L2=luminance(hexToRgb(hex2));const[a,b]=L1>L2?[L1,L2]:[L2,L1];return (a+0.05)/(b+0.05)}

/* ---------- ê²€ì¦/ëª¨ë‹¬ ---------- */
const modalRequire = $('#modalRequire');
const modalAuto = $('#modalAuto');
function openModal(id){ document.getElementById(id).style.display='grid'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
function validateAll(){
  const ids=['#q_industry','#q_goal','#q_platform','#q_audience','#q_tone','#q_ban','#q_brand','#q_visual','#q_energy'];
  return ids.every(id => $(id).value !== '-');
}
function resetForm(){
  ['q_industry','q_goal','q_platform','q_audience','q_tone','q_ban','q_brand','q_visual','q_energy']
    .forEach(id=>{ const el=document.getElementById(id); if(el) el.value='-'; });
  // persona toggle reset
  btnAuto.classList.remove('active'); btnManual.classList.remove('active');
  ps_form.style.display='none'; personaMode='auto';
}

/* ---------- ë¬´ë“œ ìŠ¤ì½”ì–´ ---------- */
function scoreMood({industry,goal,platform,audience,tone,brand,visual,energy}){
  const s = {modern:0,minimal:0,retro:0,brutal:0,pop:0,tech:0,warm:0,organic:0,luxury:0,y2k:0,classic:0,sporty:0,cozy:0};
  const add=(k,v)=>s[k]+=v;
  if(industry==='tech'){ add('tech',3); add('modern',2); add('minimal',1); }
  if(industry==='fashion'){ add('pop',2); add('modern',1); add('retro',1); add('luxury',1); }
  if(industry==='food'){ add('warm',2); add('pop',1); add('organic',1); }
  if(industry==='finance'){ add('modern',2); add('minimal',2); add('luxury',1); }
  if(industry==='culture'){ add('retro',2); add('modern',1); add('brutal',1); }
  if(industry==='edu'){ add('minimal',2); add('modern',1); add('warm',1); }
  if(industry==='sports'){ add('sporty',2); add('brutal',1); add('pop',1); }
  if(industry==='travel'){ add('warm',2); add('pop',1); add('organic',1); }
  if(industry==='auto'){ add('tech',2); add('modern',2); add('sporty',1); }
  if(industry==='game'){ add('tech',1); add('pop',2); add('y2k',2); add('brutal',1); }
  if(industry==='estate'){ add('classic',2); add('modern',2); add('minimal',1); }
  if(industry==='health'){ add('warm',2); add('minimal',2); add('organic',1); }
  if(industry==='home'){ add('cozy',2); add('minimal',1); }
  if(industry==='music'){ add('pop',2); add('y2k',1); }
  if(industry==='ngo'){ add('warm',2); add('organic',1); }

  if(goal==='conversion'){ add('modern',1); add('brutal',1); add('pop',1); }
  if(goal==='awareness'){ add('minimal',1); add('modern',1); add('retro',1); }
  if(goal==='education'){ add('minimal',2); add('warm',1); }
  if(goal==='campaign'){ add('pop',2); add('brutal',2); }

  if(platform==='web'){ add('modern',2); add('minimal',1); }
  if(platform==='app'){ add('minimal',2); add('modern',1); }
  if(platform==='sns'){ add('pop',2); add('brutal',1); }
  if(platform==='poster'){ add('retro',2); add('classic',1); }

  if(audience==='youth'){ add('pop',2); add('y2k',1); }
  if(audience==='adult'){ add('minimal',1); add('warm',1); }
  if(audience==='pro'){ add('modern',2); add('minimal',1); }
  if(audience==='premium'){ add('luxury',2); add('classic',1); }

  if(tone==='trust'){ add('modern',2); add('minimal',1); add('classic',1); }
  if(tone==='friendly'){ add('warm',2); add('pop',1); add('cozy',1); }
  if(tone==='bold'){ add('brutal',2); add('pop',1); }
  if(tone==='warm'){ add('warm',2); add('retro',1); add('organic',1); }

  if(brand==='innovative'){ add('tech',2); add('modern',1); }
  if(brand==='reliable'){ add('modern',2); add('minimal',1); }
  if(brand==='friendly'){ add('pop',2); add('warm',1); }
  if(brand==='luxury'){ add('luxury',2); add('classic',1); }

  if(visual==='photo'){ add('modern',1); add('warm',1); }
  if(visual==='illustration'){ add('pop',1); add('retro',1); }
  if(visual==='iconic'){ add('tech',1); add('minimal',1); }
  if(visual==='mixed'){ add('modern',1); add('pop',1); }

  if(energy==='calm'){ add('minimal',2); add('warm',1); }
  if(energy==='balanced'){ add('modern',1); }
  if(energy==='dynamic'){ add('brutal',2); add('pop',1); add('tech',1); }

  const entries = Object.entries(s).sort((a,b)=>b[1]-a[1]);
  return {winner: entries[0][0], scores: s};
}

/* ---------- í˜ë¥´ì†Œë‚˜ ìƒì„±(ìë™/ìˆ˜ë™ ë³‘í•©) ---------- */
function buildPersonaAuto(ctx){
  const names=['ê¹€í•˜ëŠ˜','ë°•ë¯¼ìˆ˜','ì´ì„œìœ¤','ì •ìš°ì§„','ìµœë‹¤ì€','ì˜¤ì§€í›„','ê°•ìˆ˜ë¯¼','ìœ ë¯¼ì„œ','ìœ¤ë„í˜„','í•œê°€ì€'];
  const name=names[Math.floor(Math.random()*names.length)];
  const ageMap={youth:'22â€“26',gen:'27â€“34',adult:'30â€“45',pro:'28â€“42',premium:'32â€“48'};
  const roleMap={
    tech:'í”„ë¡œë•íŠ¸ ë§ˆì¼€í„°', fashion:'ë¸Œëœë“œ MD', food:'í”„ëœì°¨ì´ì¦ˆ ë§ˆì¼€í„°', finance:'ë””ì§€í„¸ ë§ˆì¼€í„°',
    culture:'ì „ì‹œ ê¸°íšì', edu:'êµìœ¡ ì½˜í…ì¸  ê¸°íšì', sports:'ìŠ¤í°ì„œì‹­ ë§¤ë‹ˆì €', travel:'íˆ¬ì–´ ê¸°íšì',
    auto:'ëª¨ë¹Œë¦¬í‹° PM', game:'ê²Œì„ ì»¤ë®¤ë‹ˆí‹° ë§¤ë‹ˆì €', estate:'ë¶„ì–‘ ë§ˆì¼€í„°', health:'í—¬ìŠ¤ì¼€ì–´ êµìœ¡ ë§¤ë‹ˆì €',
    home:'ë¦¬ë¹™ MD', music:'ë ˆì´ë¸” í”„ë¡œëª¨í„°', ngo:'ìº í˜ì¸ ë§¤ë‹ˆì €'
  };
  const channels=(ctx.platform==='sns')?['ì¸ìŠ¤íƒ€ê·¸ë¨','í‹±í†¡','ìœ íŠœë¸Œ ì‡¼ì¸ ']:(ctx.platform==='web'||ctx.platform==='app')?['ê²€ìƒ‰','ìœ íŠœë¸Œ','ë¸ŒëŸ°ì¹˜']:['í˜„ìˆ˜ë§‰','ì§€ì—­ ì»¤ë®¤ë‹ˆí‹°','ì¸ìŠ¤íƒ€ê·¸ë¨'];
  const style={trust:'ì •ì œÂ·ëª…ë£Œ',friendly:'ë°ê³  ì¹œê·¼',bold:'ëŒ€ì¡° ê°•í•œ ê°•ì¡°í˜•',warm:'ë‰´íŠ¸ëŸ´/íœ´ë¨¼'}[ctx.tone];

  const bullets=[
    `ì„ í˜¸ í†¤: ${style}`,
    `ë¬´ë“œ ì í•©: ${MOOD_INFO[ctx.moodKey].label.replace(/ .*/,'')}`,
    `ì´ë¯¸ì§€ ì„±í–¥: ${(ctx.visual==='photo')?'ì‚¬ì§„ ì¤‘ì‹¬':'ì¼ëŸ¬ìŠ¤íŠ¸/ì•„ì´ì½˜ ì„±í–¥'}`,
    `ì˜ì‚¬ê²°ì • ê¸°ì¤€: ì •ë³´ ëª…ë£Œì„± > ì¼ê´€ì„± > ì‹¬ë¯¸ì„±`,
    `ì½˜í…ì¸  ì„ í˜¸: ${ctx.platform==='sns'?'ì§§ì€ ë¬¸ì¥ & ì¸ë„¤ì¼ ì¤‘ì‹¬':'ì„¹ì…˜í˜• ì •ë³´ & ì¦ê±° ë°ì´í„°'}`,
    `KPI: ${ctx.goal==='conversion'?'ì „í™˜ìœ¨/CTR':'ë„ë‹¬/ì²´ë¥˜/ì°¸ì—¬'}`
  ];
  const headerTags=[`ğŸ‘¤ ${name} (${ageMap[ctx.audience]||'28â€“38'})`,`ì§ë¬´: ${roleMap[ctx.industry]||'ë§ˆì¼€íŒ… ì‹¤ë¬´ì'}`,`ì±„ë„: ${channels.join('Â·')}`];
  const implication=`ë””ìì¸ ì„í”Œë¦¬ì¼€ì´ì…˜ â€” í—¤ë“œë¼ì¸ì€ ${ctx.tone==='bold'?'ì••ì¶•Â·ê°•ì¡°í˜•':'ëª…ë£ŒÂ·ê°„ê²°í˜•'}, ë¹„ì£¼ì–¼ì€ ${ctx.visual==='photo'?'ì‚¬ì‹¤ì„± ê°•í™” ì‚¬ì§„ ì¤‘ì‹¬':'ê°œë… ëª…í™•í™” ì¼ëŸ¬ìŠ¤íŠ¸/ì•„ì´ì½˜'}, ë ˆì´ì•„ì›ƒì€ ${ctx.platform==='sns'?'ì‹œë¦¬ì¦ˆ í…œí”Œë¦¿':'ì„¹ì…˜ êµ¬íš'}ìœ¼ë¡œ <b>${(ctx.goal==='conversion'?'ì „í™˜ ê·¹ëŒ€í™”':'í•µì‹¬ ì´í•´')}</b> ë‹¬ì„±.`;
  return {headerTags,bullets,implication};
}
function buildPersonaFinal(ctx){
  if(personaMode!=='manual') return buildPersonaAuto(ctx);
  const name = (document.getElementById('ps_name').value||'ê°€ìƒ ì‚¬ìš©ì').trim();
  const age  = document.getElementById('ps_age').value||'25â€“34';
  const role = (document.getElementById('ps_role').value||'ë§ˆì¼€íŒ… ì‹¤ë¬´ì').trim();
  const channels = (document.getElementById('ps_channels').value||'ì¸ìŠ¤íƒ€ê·¸ë¨, ìœ íŠœë¸Œ').split(',').map(s=>s.trim()).filter(Boolean);
  const style = document.getElementById('ps_style').value||'ì •ì œ/ëª…ë£Œ';
  const goal  = (document.getElementById('ps_goal').value||'ëª…í™•í•œ ë©”ì‹œì§€ ì „ë‹¬').trim();
  const pain  = (document.getElementById('ps_pain').value||'ì²« í™”ë©´ì—ì„œ ê´€ì‹¬ ìœ ë„ ì‹¤íŒ¨').trim();

  const headerTags=[`ğŸ‘¤ ${name} (${age})`,`ì§ë¬´: ${role}`,`ì±„ë„: ${channels.join('Â·')}`];
  const bullets=[
    `ì„ í˜¸ í†¤/ìŠ¤íƒ€ì¼: ${style}`,
    `ë¬´ë“œ ì í•©: ${MOOD_INFO[ctx.moodKey].label.replace(/ .*/,'')}`,
    `í•µì‹¬ ëª©í‘œ: ${goal}`,
    `Pain Point: ${pain}`,
    `ì˜ì‚¬ê²°ì • ê¸°ì¤€: ëª…ë£Œì„±Â·ì¼ê´€ì„±Â·ê°€ë…ì„±`,
    `ì½˜í…ì¸  ì„ í˜¸: ${ctx.platform==='sns'?'ì§§ì€ ë¬¸ì¥ & ì¸ë„¤ì¼ ì¤‘ì‹¬':'ì„¹ì…˜í˜• ì •ë³´ & ì¦ê±° ë°ì´í„°'}`
  ];
  const implication=`ë””ìì¸ ì„í”Œë¦¬ì¼€ì´ì…˜ â€” ${ctx.platform==='sns'?'ì²« ì¥ ì¸ë„¤ì¼/íƒ€ì´í‹€ë¡œ ê´€ì‹¬ í¬ì°©, ìŠ¬ë¼ì´ë“œë³„ í•œ ë©”ì‹œì§€':'íˆì–´ë¡œ ê°€ì‹œì„±, ì„¹ì…˜ êµ¬íšê³¼ ì¦ê±° ë°ì´í„° ë…¸ì¶œ'}ë¥¼ í†µí•´ <b>${goal}</b> ë‹¬ì„±.`;
  return {headerTags, bullets, implication};
}

/* ---------- íƒ€ì´í¬ ì¶”ì²œ ---------- */
function typoRecommend(audience,tone){
  const pick = (arr,bias=0)=>arr[(Math.floor(Math.random()*arr.length)+bias)%arr.length];
  let body='Pretendard', head='Montserrat';
  if(audience==='premium'){ body=pick(['Noto Serif KR','Cormorant Garamond','Source Serif 4','Lora','DM Serif Text'],1);
                            head=pick(['Playfair Display','DM Serif Display','Cinzel','Noto Serif KR','Cabinet Grotesk'],2); }
  else if(audience==='pro' || tone==='trust'){ body=pick(['Inter','Source Sans 3','IBM Plex Sans KR','SUIT','Open Sans','Roboto'],1);
                                               head=pick(['Poppins','Raleway','Pretendard Black','Archivo Black','Montserrat'],1); }
  else if(tone==='friendly'){ body=pick(['Spoqa Han Sans Neo','Gmarket Sans','Nanum Gothic','SUIT','Lato'],1);
                              head=pick(['Poppins','Rounded Mplus','Noto Sans KR Bold','Pretendard Black','Montserrat']); }
  else if(tone==='bold'){ body=pick(['Inter','SUIT','Pretendard','Gmarket Sans','IBM Plex Sans KR'],2);
                          head=pick(['Oswald','Bebas Neue','Pretendard Black','Archivo Black','Montserrat'],2); }
  else if(tone==='warm'){ body=pick(['Noto Sans KR','Apple SD Gothic Neo','Nanum Gothic','Harmonia Sans'],1);
                          head=pick(['Noto Serif KR','Playfair Display','Lora','DM Serif Display','Raleway']); }
  else { body=pick(TYPO_POOL.body); head=pick(TYPO_POOL.head); }
  const guide='ë¦¬ë”© 1.6â€“1.8 / íŠ¸ë˜í‚¹ 0~+2 / ì»¤ë‹ì€ ì œëª© ê¸€ììŒ ìˆ˜ë™ ë³´ì •';
  return [body+' (ê°€ë…ì„± 16â€“18px)', head+' (ê°•ì¡°/í—¤ë“œë¼ì¸)', guide];
}

/* ---------- ì„±í–¥/êµ¬ì„± ë¹„ìœ¨ ê·¸ë˜í”„ ---------- */
function drawBars(moodKey,tone){
  const dims=[
    {key:'aesth',label:'ì‹¬ë¯¸ì„±'},{key:'read',label:'ê°€ë…ì„±'},
    {key:'bold',label:'ëŒ€ë‹´í•¨'},{key:'access',label:'í¸ì˜ì„±'},
    {key:'trend',label:'íŠ¸ë Œë“œì„±'}
  ];
  const base={
    modern:{aesth:80,read:85,bold:55,access:80,trend:70},
    minimal:{aesth:78,read:88,bold:40,access:85,trend:65},
    retro:{aesth:75,read:72,bold:60,access:70,trend:60},
    brutal:{aesth:68,read:60,bold:90,access:55,trend:75},
    pop:{aesth:72,read:70,bold:78,access:65,trend:82},
    tech:{aesth:74,read:76,bold:65,access:72,trend:85},
    warm:{aesth:78,read:78,bold:50,access:80,trend:62},
    organic:{aesth:76,read:80,bold:42,access:82,trend:60},
    luxury:{aesth:86,read:80,bold:55,access:78,trend:75},
    y2k:{aesth:70,read:64,bold:82,access:58,trend:88},
    classic:{aesth:82,read:82,bold:48,access:80,trend:66},
    sporty:{aesth:72,read:72,bold:78,access:66,trend:78},
    cozy:{aesth:76,read:80,bold:46,access:82,trend:63}
  };
  const toneAdj=(k)=>({trust:{read:+6,access:+6,bold:-6,trend:-2}[k]||0,
                       friendly:{read:+2,access:+2,aesth:+2,bold:-2}[k]||0,
                       bold:{bold:+10,read:-4,access:-4,trend:+4}[k]||0,
                       warm:{aesth:+3,read:+3,access:+3,trend:-2}[k]||0}[tone]||0);
  const prof=base[moodKey]||base.modern;
  const box=$('#barBox'); box.innerHTML='';
  dims.forEach(d=>{
    const v=Math.max(0,Math.min(100,(prof[d.key]||70)+(toneAdj(d.key)||0)));
    box.insertAdjacentHTML('beforeend',`<div class="barRow"><div class="small">${d.label}</div><div class="bar"><i style="width:${v}%"></i></div></div>`);
  });
}
function drawComposition(platform,goal){
  // ì´ë¯¸ì§€/í…ìŠ¤íŠ¸/ì—¬ë°±/CTA ê°•ì¡° ë¹„ìœ¨(ê°€ì´ë“œ ê°’)
  let img=50, txt=35, white=15, cta=50;
  if(platform==='sns'){
    if(goal==='education'){ img=30; txt=50; white=20; cta=35; }
    else if(goal==='campaign'){ img=55; txt=30; white=15; cta=70; }
    else { img=60; txt=30; white=10; cta=55; }
  }else if(platform==='web'){ img=45; txt=35; white=20; cta=(goal==='conversion'?75:55); }
  else if(platform==='app'){ img=40; txt=40; white=20; cta=(goal==='conversion'?70:50); }
  else if(platform==='poster'){ img=60; txt=25; white=15; cta=(goal==='campaign'?65:45); }

  const rows=[['ì´ë¯¸ì§€ ë¹„ì¤‘',img],['í…ìŠ¤íŠ¸ ì–‘',txt],['ì—¬ë°±/í˜¸í¡',white],['CTA ê°•ì¡°',cta]];
  const box=$('#compBars'); box.innerHTML='';
  rows.forEach(([label,val])=>{
    box.insertAdjacentHTML('beforeend',`<div class="barRow"><div class="small">${label}</div><div class="bar"><i style="width:${val}%;background:linear-gradient(90deg,#34d399,#60a5fa)"></i></div></div>`);
  });
}

/* ---------- íŒ”ë ˆíŠ¸/ëŒ€ë¹„/ìŠ¤ì™€ì¹˜ ---------- */
function drawSwatches(pal){ const box=$('#swatches'); box.innerHTML=''; pal.forEach(c=>{box.insertAdjacentHTML('beforeend',`<div class="c"><div style="background:${c}"></div><span>${c.toUpperCase()}</span></div>`);}); }

/* ---------- ë ˆì´ì•„ì›ƒ ë¹„ìœ¨(ì •í™•/ì¶”ì²œ) ---------- */
function renderRatioPreview(ratios, activeSet=new Set()){
  const line = $('#ratioLine'); line.innerHTML='';
  ratios.forEach(r=>{
    const el=document.createElement('div'); el.className='ratio'; el.dataset.ratio=r;
    if(activeSet.has(r)) el.classList.add('active');
    const inner=document.createElement('div'); inner.className='inner';
    const lab=document.createElement('label'); lab.textContent=r;
    el.appendChild(inner); el.appendChild(lab); line.appendChild(el);
  });

  // 0 í”½ì…€ ì´ìŠˆ ë°©ì§€ + ì •í™• ë¹„ìœ¨ ì„¼í„°ë§
  line.querySelectorAll('.ratio').forEach(box=>{
    let w=box.clientWidth-16, h=box.clientHeight-16;
    if(w<=0||h<=0){ w=92; h=56; } // fallback
    const [a,b]=box.dataset.ratio.split(':').map(Number);
    let iw=w, ih=iw*(b/a);
    if(ih>h){ ih=h; iw=ih*(a/b); }
    const inner=box.querySelector('.inner');
    inner.style.width=iw+'px'; inner.style.height=ih+'px';
    inner.style.left=((w-iw)/2+8)+'px'; inner.style.top=((h-ih)/2+8)+'px';
  });
}
function recommendRatios(platform,goal,tone){
  const score={'1:1':0,'4:5':0,'16:9':0};
  if(platform==='sns'){ score['1:1']+=3; score['4:5']+=3; score['16:9']+=1; }
  if(platform==='poster'){ score['4:5']+=4; score['1:1']+=2; score['16:9']+=1; }
  if(platform==='web'||platform==='app'){ score['16:9']+=4; score['4:5']+=2; score['1:1']+=1; }
  if(goal==='campaign'){ score['4:5']+=1; score['16:9']+=1; }
  if(tone==='bold'){ Object.keys(score).forEach(k=>score[k]+=0.5); }
  return new Set(Object.entries(score).sort((a,b)=>b[1]-a[1]).slice(0,2).map(([k])=>k));
}

/* ---------- ê²°ê³¼ ë¹Œë“œ ---------- */
function buildResult(){
  const industry=$('#q_industry').value, goal=$('#q_goal').value, platform=$('#q_platform').value;
  const audience=$('#q_audience').value, tone=$('#q_tone').value, ban=$('#q_ban').value;
  const brand=$('#q_brand').value, visual=$('#q_visual').value, energy=$('#q_energy').value;

  // íƒœê·¸/ìš”ì•½
  $('#tagIndustry').textContent = '#'+$('#q_industry').selectedOptions[0].textContent;
  $('#tagGoal').textContent     = '#'+$('#q_goal').selectedOptions[0].textContent;
  $('#tagPlatform').textContent = '#'+$('#q_platform').selectedOptions[0].textContent;
  $('#tagAudience').textContent = '#'+$('#q_audience').selectedOptions[0].textContent;
  $('#tagTone').textContent     = '#'+$('#q_tone').selectedOptions[0].textContent;
  $('#tagBan').textContent      = (ban==='none'?'#ì œì•½ ì—†ìŒ':'#'+$('#q_ban').selectedOptions[0].textContent);

  const moodScores=scoreMood({industry,goal,platform,audience,tone,brand,visual,energy});
  const moodKey=moodScores.winner, mood=MOOD_INFO[moodKey];

  $('#summaryText').innerHTML = `ì„ íƒê°’ì„ ë°”íƒ•ìœ¼ë¡œ <b>${mood.label}</b> ë¬´ë“œê°€ ê°€ì¥ ì í•©í•©ë‹ˆë‹¤. ì´ ë¬´ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒ”ë ˆíŠ¸Â·ì„œì²´Â·ë ˆì´ì•„ì›ƒÂ·êµ¬ì„±ë¹„ìœ¨Â·í˜ë¥´ì†Œë‚˜ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.`;
  $('#moodTitle').textContent = `#ë¬´ë“œ ì¶”ì²œ Â· ${mood.label}`;
  const mt=$('#moodTags'); mt.innerHTML=''; (mood.tags||[]).forEach(t=>mt.insertAdjacentHTML('beforeend',`<span class="tag">${t}</span>`));

  // í˜ë¥´ì†Œë‚˜
  const persona = buildPersonaFinal({industry,goal,platform,audience,tone,brand,visual,energy,moodKey});
  const ph=$('#personaHeader'); ph.innerHTML=''; persona.headerTags.forEach(t=>ph.insertAdjacentHTML('beforeend',`<span class="tag">${t}</span>`));
  $('#personaPoints').innerHTML = persona.bullets.map(x=>`<li>${x}</li>`).join('');
  $('#personaImp').innerHTML = persona.implication;

  // íŒ”ë ˆíŠ¸ + ëŒ€ë¹„
  let pal=[...(mood.colors||['#111827','#2563eb','#e5e7eb','#0ea5e9','#f8fafc'])];
  if(ban==='noNeon' && (moodKey==='pop'||moodKey==='tech'||moodKey==='y2k')) pal=pal.map((hex,i)=> i===1||i===2 ? '#64748b' : hex);
  if(ban==='hiDensity') pal=pal.map((hex,i)=> i===1 ? '#334155' : hex);
  if(ban==='noStocky' && visual==='photo') pal=['#111827','#6b7280','#e5e7eb','#94a3b8','#f8fafc'];
  drawSwatches(pal);
  const bg=pal[pal.length-1], fg='#111111', ratio=contrast(bg,fg);
  const label= ratio>=7 ? 'ê°€ë…ì„±: ë§¤ìš° ìš°ìˆ˜' : ratio>=4.5 ? 'ê°€ë…ì„±: ìš°ìˆ˜' : 'ê°€ë…ì„±: ë³´í†µ';
  $('#contrastNote').textContent=label; $('#meter').style.width=Math.min(100,(ratio/7)*100)+'%';

  // íƒ€ì´í¬
  const [body,head,rule]=typoRecommend(audience,tone);
  $('#typoList').innerHTML = `<li>ë³¸ë¬¸: <b>${body}</b></li><li>í—¤ë“œë¼ì¸: <b>${head}</b></li><li>${rule}</li>`;
  $('#typeAccess').textContent = label.replace('ê°€ë…ì„±','ì›¹ ì ‘ê·¼ì„±');

  // ë ˆì´ì•„ì›ƒ ê°€ì´ë“œ + ë¹„ìœ¨ ì¶”ì²œ
  const guide=LAYOUT_GUIDE[platform]||LAYOUT_GUIDE.web;
  $('#gridList').innerHTML=guide.map(g=>`<li>${g}</li>`).join('');
  const ratios=['1:1','4:5','16:9'];
  const active=recommendRatios(platform,goal,tone);
  renderRatioPreview(ratios,active);

  // êµ¬ì„± ë¹„ìœ¨ + ì„±í–¥ ê·¸ë˜í”„
  drawComposition(platform,goal);
  drawBars(moodKey,tone);
}

/* ---------- ì´ë²¤íŠ¸/í† ê¸€/ë¡œë”© ---------- */
const btnAuto=document.getElementById('btnAuto');
const btnManual=document.getElementById('btnManual');
const ps_form=document.getElementById('ps_form');
let personaMode='auto';

btnAuto.onclick=()=>{
  personaMode='auto';
  btnAuto.classList.add('active'); btnManual.classList.remove('active');
  ps_form.style.display='none';
  openModal('modalAuto');
};
btnManual.onclick=()=>{
  personaMode='manual';
  btnManual.classList.add('active'); btnAuto.classList.remove('active');
  ps_form.style.display='';
};

document.getElementById('goResult').onclick=()=>{
  if(!validateAll()){ openModal('modalRequire'); return; }
  // ë¡œë”©
  const loading=document.getElementById('loading');
  loading.style.display='grid';
  setTimeout(()=>{
    buildResult();
    loading.style.display='none';
    document.getElementById('screen-ask').style.display='none';
    document.getElementById('screen-result').style.display='';
    window.scrollTo({top:0,behavior:'smooth'});
  }, 1300);
};

document.getElementById('back').onclick=()=>{
  resetForm();
  document.getElementById('screen-result').style.display='none';
  document.getElementById('screen-ask').style.display='';
  window.scrollTo({top:0,behavior:'smooth'});
};
document.getElementById('print').onclick=()=>window.print();
</script>
</body>
</html>
